---
interface Props {
  title: string;
  href: string;
  description?: string;
  date?: Date;
  badge?: string;
  badgeTone?: 'default' | 'violet';
  badges?: Array<{ text: string; tone?: 'default' | 'violet' }>;
  image?: string;
  target?: string;
  rel?: string;
}

const { title, href, description, date, badge, badgeTone, badges, image, target, rel } = Astro.props;

const formattedDate = date ? new Intl.DateTimeFormat('en-US', {
  year: 'numeric',
  month: 'short',
  day: 'numeric',
}).format(date) : null;

const badgeItems = badges?.length
  ? badges
  : badge
    ? [{ text: badge, tone: badgeTone ?? 'default' }]
    : [];
---

<article class="card">
  <a href={href} class="card__link" target={target} rel={rel}>
    {image && (
      <div class="card__image">
        <img src={image} alt="" loading="lazy" />
      </div>
    )}
    <div class="card__content">
      {badgeItems.length > 0 && (
        <div class="card__badges">
          {badgeItems.map((item) => (
            <span class={`card__badge${item.tone === 'violet' ? ' card__badge--violet' : ''}`}>
              {item.text}
            </span>
          ))}
        </div>
      )}
      <h3 class="card__title">{title}</h3>
      {description && <p class="card__description">{description}</p>}
      {formattedDate && <time class="card__date">{formattedDate}</time>}
    </div>
    <div class="card__arrow">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M5 12h14M12 5l7 7-7 7"/>
      </svg>
    </div>
  </a>
</article>

<style lang="scss">
  .card {
    background: var(--color-bg-secondary);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-lg);
    overflow: hidden;
    transition: all var(--transition-normal);
    
    &:hover {
      border-color: var(--color-border-hover);
      box-shadow: var(--shadow-lg), var(--shadow-glow);
      transform: translateY(-2px);
    }
    
    &__link {
      display: flex;
      flex-direction: column;
      height: 100%;
      text-decoration: none;
      color: inherit;
      
      &:hover {
        text-decoration: none;
      }
    }
    
    &__image {
      aspect-ratio: 16 / 9;
      overflow: hidden;
      
      img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform var(--transition-slow);
      }
    }
    
    &:hover &__image img {
      transform: scale(1.05);
    }
    
    &__content {
      flex: 1;
      padding: var(--space-5);
      display: flex;
      flex-direction: column;
      gap: var(--space-2);
    }

    &__badges {
      display: inline-flex;
      flex-wrap: wrap;
      gap: var(--space-2);
    }
    
    &__badge {
      display: inline-block;
      width: fit-content;
      padding: var(--space-1) var(--space-3);
      font-size: var(--text-xs);
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--color-accent-primary);
      background: var(--color-accent-glow);
      border-radius: var(--radius-full);
    }

    &__badge--violet {
      color: var(--color-ledger-purple);
      background: rgba(106, 55, 148, 0.2);
      box-shadow: 0 0 12px rgba(106, 55, 148, 0.35);
    }
    
    &__title {
      font-size: var(--text-lg);
      font-weight: 600;
      color: var(--color-text-primary);
      line-height: var(--leading-tight);
      margin: 0;
    }
    
    &__description {
      font-size: var(--text-sm);
      color: var(--color-text-secondary);
      line-height: var(--leading-relaxed);
      margin: 0;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
    
    &__date {
      font-size: var(--text-xs);
      color: var(--color-text-tertiary);
      margin-top: auto;
    }
    
    &__arrow {
      display: flex;
      align-items: center;
      justify-content: flex-end;
      padding: 0 var(--space-5) var(--space-4);
      color: var(--color-text-tertiary);
      transition: all var(--transition-fast);
      
      svg {
        transform: translateX(-4px);
        transition: transform var(--transition-fast);
      }
    }
    
    &:hover &__arrow {
      color: var(--color-accent-primary);
      
      svg {
        transform: translateX(0);
      }
    }
  }
</style>

---
const base = import.meta.env.BASE_URL;
const withBase = (path) => `${base}${path.replace(/^\/+/, '')}`;

const navigation = [
  { name: 'Bounty', href: withBase('/bounty/') },
  { name: 'Security Bulletins', href: withBase('/lsb/') },
  { name: 'Threat Model', href: withBase('/threat-model/') },
  { name: 'Tools Suite', href: withBase('/tools-suite/') },
  { name: 'Blog', href: withBase('/blog/') },
  { name: 'About', href: withBase('/about/') },
  { name: 'Contact', href: withBase('/contact/') },
];

const currentPath = Astro.url.pathname;
---

<header class="header">
  <div class="header__container">
    <a href={base} class="header__logo" aria-label="Ledger Donjon Home">
      <img src={withBase('/ledgerdonjon_banner.png')} alt="Ledger Donjon" class="header__logo-img" />
    </a>
    
    <nav class="header__nav" aria-label="Main navigation">
      <ul class="header__nav-list">
        {navigation.map((item) => (
          <li>
            <a 
              href={item.href} 
              class:list={['header__nav-link', { 'is-active': currentPath.startsWith(item.href) }]}
            >
              {item.name}
            </a>
          </li>
        ))}
      </ul>
    </nav>
    
    <button class="header__toggle" aria-label="Toggle menu" aria-expanded="false">
      <span></span>
      <span></span>
      <span></span>
    </button>
  </div>
</header>

<style lang="scss">
  .header {
    position: sticky;
    top: 0;
    z-index: var(--z-sticky);
    background: rgba(10, 14, 20, 0.85);
    backdrop-filter: blur(12px);
    border-bottom: 1px solid var(--color-border);
    
    &__container {
      max-width: var(--max-width);
      margin: 0 auto;
      padding: var(--space-4) var(--space-6);
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: var(--space-8);
    }
    
    &__logo {
      display: flex;
      align-items: center;
      flex-shrink: 0;
      
      &-img {
        height: 32px;
        width: auto;
        filter: invert(1) hue-rotate(180deg);
      }
    }
    
    &__nav {
      @media (max-width: 960px) {
        position: fixed;
        top: 65px;
        left: 0;
        right: 0;
        bottom: 0;
        background: var(--color-bg-primary);
        background-color: var(--color-bg-primary);
        background-image: none;
        padding: var(--space-6);
        z-index: var(--z-sticky);
        isolation: isolate;
        transform: translateX(100%);
        opacity: 0;
        visibility: hidden;
        pointer-events: none;
        transition: transform var(--transition-normal), opacity var(--transition-fast);

        &::before {
          content: '';
          position: absolute;
          inset: 0;
          background-color: var(--color-bg-primary);
          z-index: 0;
        }
        
        &.is-open {
          transform: translateX(0);
          opacity: 1;
          visibility: visible;
          pointer-events: auto;
        }
      }
    }
    
    &__nav-list {
      display: flex;
      align-items: center;
      gap: var(--space-1);
      list-style: none;
      padding: 0;
      margin: 0;
      
      @media (max-width: 960px) {
        position: relative;
        z-index: 1;
        background-color: var(--color-bg-primary);
        background-image: none;
        border-radius: var(--radius-lg);
        padding: var(--space-2);
        flex-direction: column;
        align-items: stretch;
        gap: var(--space-2);
      }
    }
    
    &__nav-link {
      display: inline-flex;
      align-items: center;
      gap: var(--space-2);
      padding: var(--space-2) var(--space-3);
      font-size: var(--text-sm);
      font-weight: 500;
      color: var(--color-text-secondary);
      border-radius: var(--radius-md);
      transition: all var(--transition-fast);
      text-decoration: none;
      
      &:hover {
        color: var(--color-text-primary);
        background: var(--color-bg-hover);
        text-decoration: none;
      }
      
      &.is-active {
        color: var(--color-accent-primary);
        background: var(--color-accent-glow);
      }
      
      &--external svg {
        opacity: 0.5;
        transition: opacity var(--transition-fast);
      }
      
      &--external:hover svg {
        opacity: 1;
      }
      
      @media (max-width: 960px) {
        padding: var(--space-4);
        font-size: var(--text-base);
      }
    }
    
    &__toggle {
      display: none;
      flex-direction: column;
      justify-content: center;
      gap: 5px;
      width: 32px;
      height: 32px;
      background: var(--color-bg-secondary);
      border: 1px solid var(--color-border);
      border-radius: var(--radius-md);
      cursor: pointer;
      padding: 4px;
      
      span {
        display: block;
        width: 100%;
        height: 2px;
        background: var(--color-text-primary);
        border-radius: 2px;
        transition: all var(--transition-fast);
      }
      
      &[aria-expanded="true"] {
        span:nth-child(1) {
          transform: rotate(45deg) translate(5px, 5px);
        }
        span:nth-child(2) {
          opacity: 0;
        }
        span:nth-child(3) {
          transform: rotate(-45deg) translate(5px, -5px);
        }
      }
      
      @media (max-width: 960px) {
        display: flex;
      }
    }
  }
</style>

<script>
  const toggle = document.querySelector('.header__toggle');
  const nav = document.querySelector('.header__nav');
  
  toggle?.addEventListener('click', () => {
    const isExpanded = toggle.getAttribute('aria-expanded') === 'true';
    toggle.setAttribute('aria-expanded', (!isExpanded).toString());
    nav?.classList.toggle('is-open');
  });
</script>
